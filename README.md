# Курсовая 5. Работа с базами данных
### Задание:
В рамках проекта необходимо получить данные о компаниях и вакансиях с сайта hh.ru, спроектировать таблицы в БД PostgreSQL и загрузить полученные данные в созданные таблицы.

## От автора:
Небольшая программа парсинга HH.RU с использованием базы данных PostgreSQL.

Внимание! Интерфейс пользователя не реалзован. Имеется небольшое демоснтрационное управление для начальных действий.

### Требования:
    PostgreSQL


1. Модуль settings.py хранит небольшие первоначальные настройки.

---
    MAIN_URL = "https://api.hh.ru/"
    LIST_COMPANY = [1740, 78638, 2748, 3529, 4181, 15478, 2381, 3776, 6093775, 839098]
    
    # database connection
    HOST = "localhost"
    DATABASE = 'vacancies'
    USER = "postgres"
    PASSWORD = "admin"
    
    # API settings
    API_COUNT_PAGES = 10
    API_ROW_IN_PAGE = 100
---
MAIN_URL - соответственно основной url для работы программы.

LIST_COMPANY - список id кодов работодателей согласно HH.RU. В данный список можно вносить любые id коды работодателей из HH.RU.

далее идет насройка servera PostgreSQL. Если используете другие варианты подключения к PosqgreSQL тогда внесите свои данные для подключения.

API settings - здесь небольшие насройки для парсинга страниц.

API_COUNT_PAGES - количество страниц для парсинга.

API_ROW_IN_PAGE - колиство записей на одной странице.


2. Модуль CreateDB.py (class NewDataBase)  для создания БД содержит следующие процедуры:

---
    create_db  -  процедура создает новую базу данных
    create_tables - процедура создает таблицы в базе данных для работы программы
---

3. Модуль hhAPI.py (class HeadHunterAPI) для парсинга содержит следующие процедуры:

---
    get_all - получает требуемые данные с HH.RU
    get_page - получает только заданную страницу c HH.RU
    get_areas - получает список всех стран, регионов и городов работодателей
    get_employer -  получает данные по работодателю
    get_vacancies - получает вакансии по заданному работодателю
---

4. Модуль fillDB.py (class FillDataBase) заполняет БД данными полученными от HH.RU 

---
    fill_areas - заполняет таблицу areas (страны, регионы, города)
    fill_data - заполняет таблицы epmployers и vacancies данными
---

5. Модуль db_manager.py (class DBManager) для работы с БД.

---
    is_exists_db - процедура проверяет наличие БД
    is_exists_data - процедура проверяет наличие данных в БД
    clear_data - процедура полной очистки БД
    get_data - процедура получения данных
    get_companies_and_vacancies_count - получает список всех компаний и количество вакансий у каждой компании.
    get_all_vacancies - получает список всех вакансий с указанием названия компании, названия вакансии и зарплаты и ссылки на вакансию.
    get_avg_salary - получает среднюю зарплату по вакансиям. Внимание! В расчете не участвуют вакансии с нулевой зарплатой.
    get_avg_row_salary - Процедура расчёта средней заработной платы по 1 записи
    get_vacancies_with_higher_salary - получает список всех вакансий, у которых зарплата выше средней по всем вакансиям.
    get_vacancies_with_keyword - получает список всех вакансий, в названии которых содержатся переданные в метод слова, например python.
---

6. Модуль main.py (модуль не главный и используется только для демнстрации программы)

    Для запуска демонстрации запустите main.py

    После запуска программы (когда нет БД) программа сообщит что БД не обранужена:

---
    Не удалось установить соединение с базой данных.
    Хотите создать новую базу данных? (Y/N):
---

Для дальнейшей работы требуется ответить Y. Далее будет создана БД и таблицы в ней о чем будет сообщено далее:

---
    База данных успешно создана.
    Таблица employers создана.
    Таблица vacancies создана.
    Таблица areas создана.
    Таблица areas загружена
---

Сразу же начнется загрузка данных согласно списка LIST_COMPANY из settings.py. Придется немного подождать.
В процессе загрузки данных будут выводится информационные строки о загруженных данных, например:

---
    Ждите! Идет загрузка данных по коду [1740]..........'Яндекс'. Готово!
    Ждите! Идет загрузка данных по коду [78638]..........'Тинькофф'. Готово!
    Ждите! Идет загрузка данных по коду [2748]..........'Ростелеком'. Готово!
    Ждите! Идет загрузка данных по коду [3529]..........'СБЕР'. Готово!
    Ждите! Идет загрузка данных по коду [4181]..........'Банк ВТБ (ПАО)'. Готово!
    Ждите! Идет загрузка данных по коду [15478]..........'VK'. Готово!
    Ждите! Идет загрузка данных по коду [2381]..........'Softline'. Готово!
    Ждите! Идет загрузка данных по коду [3776]..........'МТС'. Готово!
    Ждите! Идет загрузка данных по коду [6093775]..........'Aston'. Готово!
    Ждите! Идет загрузка данных по коду [839098].'Автомакон'. Готово!
---

После загрузки всех данных выводится сообщение:
---

    Все данные загружены!
    В базе данных присутствуют данные.
    Использовать текущие данные? (Y/N): 
---

Если ответить положительно (Y) тогда будут выведены как пример некоторые данные:

---

    [('Ростелеком', 1000), ('Яндекс', 1000), ('Банк ВТБ (ПАО)', 1000), ('СБЕР', 1000), ('Автомакон', 55), ('МТС', 1000), ('Softline', 238), ('VK', 442), ('Тинькофф', 1000), ('Aston', 305)]
    70703.22
    (343, 'Разработчик в буткемп Core Infrastructure', 4, 250000, 450000, 'RUR', 'https://hh.ru/vacancy/88416827', 'Знаете классические алгоритмы и структуры данных. Работали с SQL. Работали с видео, сетью или большими объёмами данных.', 1740, 'Новосибирск', 'Яндекс')
    (3179, 'Python-разработчик', 1, None, None, None, 'https://hh.ru/vacancy/88516204', 'Уверенное владение python3. Знание классических алгоритмов и структур данных. Опыт в области парсинга сайтов. Опыт работы с любыми синхронными...', 3529, 'Москва', 'СБЕР')
---

1-я строка - список организаций и кольчество вакансий в БД.

2-я строка - средняя заработная плата.

3-я строка - первая запись из списка согласно get_vacancies_with_higher_salary.

4-я строка - первая запись из списка согласно get_vacancies_with_keyword.

Просле вывода данной информации программа (демо) завершает работу.

ВНИМАНИЕ! Если запустить программу повторно, то уже будет предложено воспользоваться имеющимеся данными в БД или очистить и загрузить данные заново.
